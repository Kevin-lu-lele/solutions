<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <!-- <meta name="viewport" content="width=750, user-scalable=no, target-densitydpi=device-dpi"> -->
    <!-- width取值与页面定义的宽度一致 -->
    <meta name="viewport" content="width=640, user-scalable=no" />
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta content="email=no" name="format-detection">
    <title>标题</title>
    <link rel="stylesheet" href="css/reset.css">
    <style type="text/css">
* { padding: 0; margin: 0; }
html { -webkit-text-size-adjust: none; }
body { height: 3000px; line-height: 1.6; font-family: -apple-system-font, Helvetica Neue, sans-serif }
.pop-dialog .pop-tit {text-align: center; font-weight: 400; font-size: 30px; padding: 26px 32px 10px;}
.pop-dialog .pop-mask { position: fixed; z-index: 1000; top: 0; right: 0; left: 0; bottom: 0; background: rgba(0, 0, 0, .6); }
.pop-dialog .con-dialog { position: absolute; z-index: 5000; width: 520px; top: 50%; left: 50%;  background-color: #fff; text-align: center; border-radius: 5px; }
.pop-dialog .pop-item{text-align: left;}
.pop-dialog .pop-dialog__bd { text-align: left; width: 428px; margin: 0 auto; padding: 0 32px 16px; min-height: 40px; font-size: 15px; line-height: 1.3; word-wrap: break-word; word-break: break-all; color: #999 }
.pop-dialog .pop-btn { position: relative; display: block; margin-left: auto; margin-right: auto; padding-left: 14px; padding-right: 14px; box-sizing: border-box; font-size: 24px; text-align: center; text-decoration: none; color: #fff; line-height: 2.55555556; border-radius: 5px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); overflow: hidden }
.pop-dialog .pop-btn:after { content: " "; width: 200%; height: 200%; position: absolute; top: 0; left: 0; border: 1px solid rgba(0, 0, 0, .2); -webkit-transform: scale(.5); transform: scale(.5); -webkit-transform-origin: 0 0; transform-origin: 0 0; box-sizing: border-box; border-radius: 10px }
.pop-dialog .pop-btn_inline { display: inline-block }
.pop-dialog .pop-btn_mini { display: inline-block; padding: 0 26px; line-height: 2.3; font-size: 18px }
.pop-dialog .pop-btn_default { color: #000; background-color: #f8f8f8 }
.pop-dialog .pop-btn_primary { background-color: #1aad19 }
.pop-dialog .pop-input { padding: 4px 6px; border: 1px solid #aaa; box-sizing: border-box; height: 50px; line-height: 50px; width: 400px; font-size: 24px; margin-top: 30px; }
.pop-dialog .yy-btn { width: 160px; }
.pop-dialog .code-input { width: 250px; }
.pop-dialog .get-code-btn { vertical-align: bottom; height: 50px; line-height: 50px; margin-left: 10px; }
.pop-dialog .button_sp_area { padding: 15px 0; }
.pop-dialog .yy-succ { padding: 50px 0; line-height: 40px; text-align: center; font-size: 24px; color: #e64340; }
.pop-dialog .yy-back { text-align: center; }
.pop-dialog .os-sel { line-height: 34px; text-align: center; font-size: 20px; }
.pop-dialog .os-sel label { display: inline-block; height: 34px; line-height: 34px; }
.pop-dialog .os-sel em { position: relative; display: inline-block; width: 26px; height: 26px; margin-right: 10px; border-radius: 18px; font-size: 0; line-height: 0; border: solid 2px #aaa; vertical-align: middle; font-size: inherit; text-rendering: auto; }
.pop-dialog .os-sel .active:after { content: ""; position: absolute; top: 3px; left: 3px; width: 20px; height: 20px; border-radius: 14px; display: inline-block; background: #09bb07; vertical-align: middle; }
.pop-dialog .os-sel label { vertical-align: middle; margin-right: 20px; }
.pop-dialog .btn_disabled{color: rgba(0,0,0,.3);background-color: #f7f7f7;}
.pop-dialog .close-box{position: absolute;width: 40px; height: 40px;  top: 0px; right: -40px;}
.pop-dialog .close-box:after{position: absolute; top: 0;left: 50%; content: ""; width: 2px; height: 40px;background: #fff; transform: rotate(-45deg); -webkit-transform: rotate(-45deg);}
.pop-dialog .close-box:before{position: absolute; top: 0;left: 50%; content: ""; width: 2px; height: 40px;background: #fff; transform: rotate(45deg); -webkit-transform: rotate(45deg);}

</style>
<script>
if (navigator.appVersion.indexOf('Android') != -1) { document.addEventListener("DOMContentLoaded", function(e) { document.getElementsByTagName('body')[0].style.zoom = e.target.activeElement.clientWidth / 640; }
); }
;
	</script>
</head>

<body>
内容.......内容........<br />
内容.......内容........<br />
内容.......内容........<br />
内容.......内容........<br />
内容.......内容........<br />
内容.......内容........<br />
内容.......内容........<br />
内容.......内容........<br />
内容.......内容........<br />
内容.......内容........<br />
内容.......内容........<br />
内容.......内容........<br />
内容.......内容........<br />
内容.......内容........<br />
内容.......内容........<br />
<div class="pop-dialog" id="Dialog1" >
    <div class="pop-mask"></div>
    <div class="con-dialog ">
        <a href="javascript:void(0);" class="close-box"></a>
        <h3 class="pop-tit">游戏预约</h3>
        <div class="pop-dialog__bd pop-step1" id="step1">
            <!-- <div class="os-sel">
                <label for="android"><em class="active"></em>安卓系统</label>
                <label for="ios"><em></em>IOS系统</label>
            </div> -->
            <div class="pop-item">
                <input type="text" maxlength="11" class="pop-input phone-input" id="phone-input" value="" placeholder="输入手机号">
            </div>
            <div class="pop-item">
                <input maxlength="6" class="pop-input code-input" id="code-input" placeholder="验证码"><a href="javascript:;" class="pop-btn pop-btn_mini pop-btn_default get-code-btn" id="getCodeBtn">获取验证码</a>
            </div>            
            <div class="button_sp_area">
                <a href="javascript:;" class="pop-btn pop-btn_primary yy-btn" id="subBtn">提交</a>
            </div>
        </div>
        <div class="pop-dialog__bd pop-step2" id="step2" style="display:none;">
             <p class="yy-succ">预约成功</p>
             <div class="yy-back">
                <a href="javascript:;" class="pop-btn pop-btn_mini pop-btn_default" id="pop-back">返回</a>
             </div>             
        </div>
    </div>
</div>
<script type="text/javascript" src="http://event.changyou.com/all/js/jquery-1.7.1.min.js"></script>
<script type="text/javascript">

var appoint = {}
    $(function(){
    appoint = {
        conf:{
            game:"toufang",//游戏 toufang
            actv_key:"ldj_20180608",//活动key
            cdk_type:"",//礼包码是否相同（不填获取不同CDK）
            phone_num:"15010363631",
            device_type:"",//手机型号（非必填）
            phone_code:""
        },
        times:"",
        time_num:60,
        u_phone:new RegExp("^1[0-9][0-9]{9}$"),
        code:new RegExp("^[0-9]{6}$"),
        clear_times:function(){
            clearInterval(this.times);
            $("#getCodeBtn").removeClass('btn_disabled');
            $("#getCodeBtn").text('获取验证码');
        },
        countdown:function(){
                this.time_num--;
                $("#getCodeBtn").text("*" + this.time_num + "s后再试");
                if (this.time_num <= 0) {
                    this.clear_times();
                    this.time_num = 60;
                }
        },    
        //验证码检测
        checkCode:function(){
            var num = $.trim($("#code-input").val());
            this.conf.phone_code = '';
            if(!this.code.test(num)){            
                alert("请输入正确的验证码");
                return false;
            }else{
                this.conf.phone_code = num;
                return true;
            }
        },
        //手机号验证
        checkPhone:function(){
            var phone = $.trim($("#phone-input").val());
            this.conf.phone_num = '';
            if(!this.u_phone.test(phone)){            
                alert("请输入正确的手机号");
                return false;
            }else{
                this.conf.phone_num = phone;
                return true;
            }
        },
        //根据手机号获取验证码
        getPhoneCode:function(){
            var _this = this;
            if(!this.checkPhone()){
                return;
            }
            $.ajax({
            type: "get",
            url: "http://activity2.changyou.com/appoint/getVerificationCode.ncdo",
            dataType: "jsonp",
            data: {
                game: _this.conf.game,
                actvKey: _this.conf.actv_key,
                phone: _this.conf.phone_num
            },
            success: function(data) {
                if (data) {
                    if (data.errCode == "000") {
                        _this.times = setInterval(function(){
                            _this.countdown();
                        }, 1000);
                        $("#getCodeBtn").addClass('btn_disabled');
                    } else if (data.errCode == "016") {
                        alert("您已预约！");                    
                    } else {
                        alert(data.errMsg);
                    }
                }
            },
            error: function() {}
        });
        },
        //提交验证码
        codeSubmit:function(){
            var _this = this;
            if(!this.checkPhone()){
                return;
            }
            if(!this.checkCode()){
                return;
            }
            $.ajax({
                type: "get",
                url: "http://activity2.changyou.com/appoint/verificationCode.ncdo",
                dataType: "jsonp",
                data: {
                    game: _this.conf.game,
                    actvKey: _this.conf.actv_key,
                    phone: _this.conf.phone_num,
                    numCode: _this.conf.phone_code
                    // col01 : mail_num,
                },
                success: function(data) {
                    if (data) {
                        if (data.errCode == "000" || data.errCode == "016") {
                            _this.clear_times();
                            _this.time_num = 60;
                            // $(".mail_num").val("");
                            $("#phone-input").val("");
                            $("#code-input").val("");
                            $("#step1").hide();
                            $("#step2").show();
                        } else {
                            alert(data.errMsg);
                        }
                    }
                },
                error: function() {}
            });
        },
        init:function(){
            var _this = this;
            $("#subBtn").click(function(){
                _this.codeSubmit();
            });
            $("#getCodeBtn").click(function(){
                _this.getPhoneCode();
            });
            $("#pop-back").click(function(){
                $("#step2").hide();
                $("#step1").show();
            });
            $(".close-box").click(function(){
                $("#Dialog1").hide();
            });
            $(".os-sel label").click(function(){
                var ind = $(this).index();
                $(".os-sel .active").removeClass("active");
                $(this).find('em').addClass('active');
            })
        }
    }
    $(window).scroll(function(event) {
        var target = $(".con-dialog");
        if($("#Dialog1").is(":visible")){
            target.css("top",($(window).height()-target.height())/2 + $(window).scrollTop())
               .css("left",($(window).width()-target.width())/2+$(window).scrollLeft())
               .css("z-index","9999")
               .fadeIn();
        }
    });
    appoint.init();
    $(window).scroll();
    });

</script>
</body>

</html>